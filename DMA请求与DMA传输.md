<<<<<<< HEAD
# DMA请求与DMA传输

``参考STM32F10xxx参考手册_V10（中文版）.pdf``
 ``10 DMA控制器(DMA) ``
 [STM32F10xxx参考手册_V10（中文版）.pdf](https://github.com/undefined-0/image-store/blob/main/PDF/STM32F10xxx%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C_V10%EF%BC%88%E4%B8%AD%E6%96%87%E7%89%88%EF%BC%89.pdf)

### 一、DMA请求简介

   DMA，全称Direct Memory Access，即直接存储器访问。DMA传输将数据从一个地址空间复制到另一个地址空间，提供在**外设和存储器、存储器和外设之间**或者**存储器和存储器之间**的高速数据传输。

### 二、DMA传输的优点

   1. 传输动作本身是由DMA控制器来完成的，无需CPU直接控制传输

   2. 没有异常/中断处理过程中**保存现场**和**恢复现场**的过程

   3. 通过硬件实现RAM和I/O设备的直接数据传输

   4. **总结：DMA传输使得CPU的效率大大提高**
### 三、DMA的特征

1. 每个通道都直接连接专用的硬件DMA请求。

2. 每个通道都支持软件触发。

3. 源和目标地址必须按数据传输宽度对齐。

4. 支持循环的缓冲器管理。

5. 共四种软件优先级（非常高、高、中等、低），软件优先级设置相等时由硬件优先级决定，硬件优先级高的优先。

   * 硬件优先级：编号低的数据流优先于编号高的数据流，即：数据流0 > 数据流1 > 数据流2 > 数据流3 > 数据流4 > ……

   * 软件优先级：通过写DMA_CCRx寄存器设置优先级，一共有4个优先级。如果优先级相同，通道号较小的优先级高。如通道2优先级高于通道4，DMA1高于DMA2。

6. 每个通道的事件标志：3个，分别为：DMA半传输、DMA传输完成、DMA传输出错。

   * 这3个事件标志逻辑或成为一个单独的中断请求

7. 闪存、SRAM、外设的SRAM、APB1、APB2和AHB外设均可作为访问的源和目标。

### 四、DMA传输方式

#### 1）DMA_Mode_Normal，正常模式
当一次DMA数据传输完后，停止DMA传送。即：只传输一次。
#### 2）DMA_Mode_Circular ，循环传输模式
当传输结束时，硬件自动会将传输数据量寄存器进行重装，进行下一轮的数据传输，即：多次传输模式。

### 五、DMA处理过程

#### 	1）事件发生→请求

事件发生时:  

1.      外设向DMA控制器发送一个请求
2.      DMA仲裁器优先级处理
3.      发送应答信号释放外设的请求
4.      外设释放请求DMA撤销应答信号

#### 	2）数据传输步骤

1. 从外设数据寄存器或者从当前外设/存储器地址寄存器指示的存储器地址**取数据**。

   ``第一次传输时的开始地址是DMA_CPARx（DMA通道x外设地址寄存器）或DMA_CMARx（DMA通道x配置寄存器）寄存器指定的外地址或内存地址。``

2. **存数据**到外设数据寄存器或者当前外设/存储器地址寄存器指示的存储器地址。

   ``第一次传输时的开始地址是DMA_CPARx或DMA_CMARx寄存器指定的外设地址或内存地址。``

3. 执行一次DMA_CNDTRx寄存器的**递减**操作。

   ``该寄存器包含未完成的操作数目。``

### 六、配置DMA通道x的过程（x为通道号）

1. 在DMA_CPARx寄存器（DMA通道x外设地址寄存器）中设置外设寄存器的地址。

   ``发生外设数据传输请求时，该地址将是数据传输的源或目标。``

2. 在DMA_CMARx（DMA通道x配置寄存器）寄存器中设置数据存储器的地址。

   ``发生外设数据传输请求时，传输的数据将从该地址读出或写入该地址。``

3. 在DMA_CNDTRx寄存器中设置要传输的数据量。

   ``在每个数据传输后，该数值递减。``

4. 在DMA_CCRx寄存器（DMA通道x配置寄存器）的PL[1:0]位中设置通道优先级。

5. 在DMA_CCRx寄存器（DMA通道x配置寄存器）中设置数据传输的方向、循环模式、外设和存储器的增量模式、外设和存储器的数据宽度、传输一半产生中断或传输完成产生中断。

6. 设置DMA_CCRx寄存器的ENABLE位（使能），启动该通道。

   ````text
   Tip:
   DMA_CCRx(DMA通道x配置寄存器)控制着 DMA 的很多相关信息，包括通道优先级、数据传输方向、循环模式、增量模式、数据宽度、中断允许、使能等。DMA_CCRx是DMA传输的核心控制寄存器。

=======
# DMA请求与DMA传输

``参考STM32F10xxx参考手册_V10（中文版）.pdf``
 ``10 DMA控制器(DMA) ``
 [STM32F10xxx参考手册_V10（中文版）.pdf](https://github.com/undefined-0/image-store/blob/main/PDF/STM32F10xxx%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C_V10%EF%BC%88%E4%B8%AD%E6%96%87%E7%89%88%EF%BC%89.pdf)

### 一、DMA请求简介

   DMA，全称Direct Memory Access，即直接存储器访问。DMA传输将数据从一个地址空间复制到另一个地址空间，提供在**外设和存储器、存储器和外设之间**或者**存储器和存储器之间**的高速数据传输。

### 二、DMA传输的优点

   1. 传输动作本身是由DMA控制器来完成的，无需CPU直接控制传输

   2. 没有异常/中断处理过程中**保存现场**和**恢复现场**的过程

   3. 通过硬件实现RAM和I/O设备的直接数据传输

   4. **总结：DMA传输使得CPU的效率大大提高**
### 三、DMA的特征

1. 每个通道都直接连接专用的硬件DMA请求。

2. 每个通道都支持软件触发。

3. 源和目标地址必须按数据传输宽度对齐。

4. 支持循环的缓冲器管理。

5. 共四种软件优先级（非常高、高、中等、低），软件优先级设置相等时由硬件优先级决定，硬件优先级高的优先。

   * 硬件优先级：编号低的数据流优先于编号高的数据流，即：数据流0 > 数据流1 > 数据流2 > 数据流3 > 数据流4 > ……

   * 软件优先级：通过写DMA_CCRx寄存器设置优先级，一共有4个优先级。如果优先级相同，通道号较小的优先级高。如通道2优先级高于通道4，DMA1高于DMA2。

6. 每个通道的事件标志：3个，分别为：DMA半传输、DMA传输完成、DMA传输出错。

   * 这3个事件标志逻辑或成为一个单独的中断请求

7. 闪存、SRAM、外设的SRAM、APB1、APB2和AHB外设均可作为访问的源和目标。

### 四、DMA传输方式

#### 1）DMA_Mode_Normal，正常模式
当一次DMA数据传输完后，停止DMA传送。即：只传输一次。
#### 2）DMA_Mode_Circular ，循环传输模式
当传输结束时，硬件自动会将传输数据量寄存器进行重装，进行下一轮的数据传输，即：多次传输模式。

### 五、DMA处理过程

#### 	1）事件发生→请求

事件发生时:  

1.      外设向DMA控制器发送一个请求
2.      DMA仲裁器优先级处理
3.      发送应答信号释放外设的请求
4.      外设释放请求DMA撤销应答信号

#### 	2）数据传输步骤

1. 从外设数据寄存器或者从当前外设/存储器地址寄存器指示的存储器地址**取数据**。

   ``第一次传输时的开始地址是DMA_CPARx（DMA通道x外设地址寄存器）或DMA_CMARx（DMA通道x配置寄存器）寄存器指定的外地址或内存地址。``

2. **存数据**到外设数据寄存器或者当前外设/存储器地址寄存器指示的存储器地址。

   ``第一次传输时的开始地址是DMA_CPARx或DMA_CMARx寄存器指定的外设地址或内存地址。``

3. 执行一次DMA_CNDTRx寄存器的**递减**操作。

   ``该寄存器包含未完成的操作数目。``

### 六、配置DMA通道x的过程（x为通道号）

1. 在DMA_CPARx寄存器（DMA通道x外设地址寄存器）中设置外设寄存器的地址。

   ``发生外设数据传输请求时，该地址将是数据传输的源或目标。``

2. 在DMA_CMARx（DMA通道x配置寄存器）寄存器中设置数据存储器的地址。

   ``发生外设数据传输请求时，传输的数据将从该地址读出或写入该地址。``

3. 在DMA_CNDTRx寄存器中设置要传输的数据量。

   ``在每个数据传输后，该数值递减。``

4. 在DMA_CCRx寄存器（DMA通道x配置寄存器）的PL[1:0]位中设置通道优先级。

5. 在DMA_CCRx寄存器（DMA通道x配置寄存器）中设置数据传输的方向、循环模式、外设和存储器的增量模式、外设和存储器的数据宽度、传输一半产生中断或传输完成产生中断。

6. 设置DMA_CCRx寄存器的ENABLE位（使能），启动该通道。

   ````text
   Tip:
   DMA_CCRx(DMA通道x配置寄存器)控制着 DMA 的很多相关信息，包括通道优先级、数据传输方向、循环模式、增量模式、数据宽度、中断允许、使能等。DMA_CCRx是DMA传输的核心控制寄存器。

>>>>>>> 3671b37344318042d5db5031a4a4075ad2f4af9c
