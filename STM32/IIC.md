# $I^2C$

## 一、$I^2C$简介

#### 1.1 简介：

* IIC(Inter-Integrated Circuit)总线是一种由 PHILIPS 公司开发的两线式串行总线，用于连接**微控制器**以及其**外围设备**，是由数据线 SDA 和时钟线 SCL 构成的串行总线，可发送和接收数据，在 CPU 与被控 IC 之间、IC 与 IC 之间进行**双向传送**。 

#### 1.2 特点： 

1. **双线制**：$I^2C$总线只需要两根线，分别是数据线（SDA）和时钟线（SCL）。数据线用来传输数据，时钟线用来传输时钟信号、同步数据收发。

2. **主从架构**：$I^2C$通信基于主从架构。一个主设备（通常是微控制器或主控制器）控制多个从设备。主设备生成时钟信号，从设备在时钟信号的控制下响应。

3. **多设备支持**：$I^2C$支持多设备连接到同一总线上。连接到总线的接口数量只由总线电容 400pF 的限制决 定。总线上每个设备都有唯一的7位地址，主设备可以选择与哪个设备通信。只要知道器件的地址，根据时序就可以实现微控制器与器件之间的通信。

4. $I^2C$支持**多种**不同的**数据传输速率**：

   * 标准模式（100 kbit/s）

   * 快速模式（400 kbit/s）

   * 高速模式（3.4 Mbit/s）

     使用者可以根据需要在速度和距离之间进行权衡。

5. **半双工通信**：$I^2C$在同一时间点只能进行单向通信。

   * SDA线：传输数据
   * SCL线：传输时钟信号

6. 以**起始和停止条件**来标识通信的开始和结束：

   * 起始条件：在SCL为高电平时，SDA从高电平切换到低电平
   * 停止条件：在SCL为高电平时，SDA从低电平切换到高电平。

7. **ACK和NAK**：在每个字节的传输后，接收设备将会发送一个应答（ACK）或非应答（NACK）位，以指示是否成功接收数据。

8. 适用于**短距离**通信：$I^2C$总线通常适用于短距离通信，通常在电子设备内部或板间通信中使用。

   * $I^2C$为开漏架构，所以它对线路上的电压不稳定性具有一定的鲁棒性，能够适应一些电压波动。
   * 为什么？在开漏架构中，输出设备通常是一个开漏输出晶体管（N-MOSFET）。当输出设备处于逻辑高电平时，它将输出线连接到地（低电平）。当输出设备处于逻辑低电平时，它不对输出线施加电压，使输出线变成高阻抗状态（浮空）。这意味着输出线在逻辑低电平时是"开放"的，所以它可以适应一些外部电压的变化。

#### 1.3 应用：

* 传感器、存储设备、显示屏、音频设备、电源管理等

#### 1.4 软件模拟 IIC的好处 ：

* **方便移植**，同一个代码兼容所有 MCU。

* 任何一个单片机只要有 IO 口，就可以很快地移植过去，而且不需要特定的 IO 口。

## 二、$I^2C$读写操作简介

#### 2.1 写操作

* $I^2C$写操作通讯过程图![image-20231013172445086](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310131756515.png)
* 写操作全流程：
  1. 主机在 IIC 总线上**发送起始信号**，总线上的从机全部等待接收由主机发出的数据
  2. 主机**发送**从机地址+0(写操作)组成的 8bit 数据
  3. 所有从机**接收**到该 8bit 数据后，自行**检验**是否是自己的设备的地址
     * 假如是自己的设备地址，那么从机就会**发出应答信号**。
  4. 主机在总线上**接收**到有**应答信号**后，才能**继续**向从机**发送数据**。
* 注：「IIC 总线上传送的数据信号」是广义的，既包括**地址信号**，又包括真正的**数据信号**。

#### 2.2 读操作

* $I^2C$读操作通讯过程图![image-20231013173505970](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310131756516.png)
* 读操作全流程：
  1. 主机在 IIC 总线上**发送起始信号**，总线上的从机全部等待接收由主机发出的数据
  2. 主机**发送**从机地址+1(读操作)组成的 8bit 数据
  3. 所有从机**接收**到该 8bit 数据后，自行**检验**是否是自己的设备的地址
     * 假如是自己的设备地址，那么从机就会**发出应答信号**并向主机**返回**8bit数据
  4. **返回**完之后，从机就会**等待**主机的**应答信号**
     * 主机**一直返回**应答信号➡从机可以**一直发送**数据
       * 即图中（n byte + 应答信号）情况
     * 直到主机**发出非应答信号**，从机才会**停止发送**数据。
