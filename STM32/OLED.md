## OLED
## 一、OLED简介

* OLED，即有机发光二极管（Organic Light-Emitting Diode），是一种利用多层有机薄膜结构产生电致发光的器件，所需驱动电压低。

* 特点：具备自发光(不需背光源)、对比度高、厚度薄、视角广、反应速度快、功耗低、柔性好。

* ![R-C](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310121657639.jpg)

* 常见的OLED都是基于芯片SSD1306的显示屏，其像素点都连接到SSD1306芯片的输出端上。这些输出由SSD1306内部的GDDRAM（Graphic Display Data RAM）中数据决定。该RAM的大小为1024字节，对应8192个像素点。

  * 用户需要做的：

    给SSD1306输入指令，并将需要显示的内容输出到GDDRAM中，从而来控制显示的内容。（显示屏不带字库，需要使用取模软件来得到显示的二进制数据）。
    
## 二、正点原子OLED模块特性简介

* 分辨率： 128*64
* 提供四种接口：
  * 两种并行接口方式
    * **6800**
      * 通过“读使能（RE）”和“写使能（WE）”两条控制线进行读写操作
    * **8080**
      * 通过“总使能（E）”和“读写选择（W/R）”两条控制线进行
  * **4 线 SPI 接口方式**
  * **IIC接口方式**（仅需要2根线）
* 工作电压：3.3V（不与5V接口兼容，会烧坏）

![image-20231012193623993](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310131555310.png)

* 默认设置：808并口方式（BS1与BS2接VCC）

## 三、硬件驱动的两种接口模式

#### 1. 8080 并口模式

##### **1.1 所需信号线：**

* CS：OLED 片选信号。 
* WR：向 OLED 写入数据。 
* RD：从 OLED 读取数据。 
* D[7：0]：8 位双向数据线。 
* RST(RES)：硬复位 OLED。（RST 上的低电平将导致 OLED 复位） 
* DC：命令/数据标志（0，读写命令；1，读写数据）。

##### **1.2  8080 并口读写过程**：

###### **写的过程：**

1. 根据要写入的数据的类型设置**DC**
   * 写入数据：高
   * 写入命令：低
2. 设置**WR**为高
   * 向 OLED **写入**数据
3. 拉低片选**CS**

   * 选中SSD1306
4. 在整个读时序上保持 **RD** 为高电平
5. 拉低 **WR** 的电平准备写入数据
6. 向数据线（**D[7：0]**）上输入要写的信息
7. 拉高 **WR**（从而得到一个 WR 的上升沿，在此上升沿使数据写入到 SSD1306 中）
   * 时序图![image-20231012200636814](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310131555312.png)

###### **读的过程：**

1. 根据要写入的数据的类型设置**DC**
   * 写入数据：高
   * 写入命令：低
2. 设置**RD**为高
   * 向 OLED **写入**数据
3. 拉低片选**CS**

   * 选中SSD1306
4. 在整个读时序上保持 **WR** 为高电平
5. 拉低 **RD** 的电平准备写入数据
6. 向数据线（**D[7：0]**）上输入要写的信息
7. 拉高 **RD**（从而得到一个 RD 的上升沿，在此上升沿使数据使数据锁存到数据线（D[7： 0]）上）
   * 时序图![image-20231012200745274](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310131555313.png)

##### 1.3  ==控制脚的信号状态==与==功能==对应表：

* SSD1306 的 8080 接口方式下**控制脚的信号状态**与**功能**对应表![image-20231012201014634](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310131555314.png)

##### 1.4 假读（Dummy Read）

* 定义：假读（Dummy Read）是指在读取单片机内部某些**寄存器**或**内存位置**中的数据时，在读取**实际所需的数据**前先读取一个**无用的数据**。从第二个字节开始才是真正要读的数据，第一个读到的字节丢弃。

* 作用：

  * 1. 先进行一次Dummy Read可以让单片机内部电路充分稳定，消除读取数据时可能产生的错误或干扰（e.g 数据总线上的噪声、时序问题），提高数据读取的准确性和可靠性。

    2. 读显存时，使得**微控制器**的操作频率和**显存**的操作频率相匹配。

    3. 用于清除一些**标志位**or**状态寄存器**。（e.g 从某个外设读取数据时，该外设的状态寄存器可能会被置位，表示数据已经准备好了。此时进行一次Dummy Read，可以清除该状态寄存器，使得下一次读取时能够正确地获取到数据）。
    

* 时序图![image-20231012203144521](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310131555316.png)

#### 2. SPI 模式

##### **2.1 所需信号线：**

* CS：OLED 片选信号。

*  RST(RES)：硬复位 OLED。（RST 上的低电平将导致 OLED 复位） 

*  DC：命令/数据标志（0，读写命令；1，读写数据）。 

* SCLK：串行时钟线。

  * 在 4 线串行模式下，D0 信号线作为串行时钟线 SCLK。 

* SDIN：串行数据线。

  * 在 4 线串行模式下，D1 信号线作为串行数据线 SDIN。 

* 模块的 D2 需要悬空，其他引脚可以接到 GND。

  

* 在 4 线串行模式下，只能往模块写数据而不能读数据。

* 在 4 线 SPI 模式下，每个数据长度均为 8 位。在 SCLK 的上升沿，数据从 SDIN 移入到 SSD1306，且高位在前。



* 4 线 SPI 写操作时序图![image-20231012204439441](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310131555317.png)

## 四、OLED显存

 #### 1. 对应关系表（有疑问）

* SSD1306 将128*64bit 大小的显存分为了 8 页，每页包含了 128 个字节，对应关系如表所示。

![image-20231013151400606](https://raw.githubusercontent.com/undefined-0/image-store/main/PicGo/202310131555318.png)

#### 2. 按字节写入时存在的问题

* 如果我们使用只写方式操作模块，写入的数据就会覆盖掉之前的状态，会导致**需要显示的点未显示/不需要显示的点显示出来**的问题。
* 解决方法：在STM32F103内部建立一个虚拟的OLED的GRAMM（共128*8=1024 个字节）每次修改时，只修改 STM32F103 上的 GRAM（实际上就是 SRAM）。在修改完成后，一次性把 STM3F103 上的 GRAM 写入到 OLED 的 GRAM。
  * GRAM：即"**G**raphics **R**andom-**A**ccess **M**emory"（**图形随机访问存储器**），是一种用于存储和管理图形数据的内存类型，用于存储当前OLED屏幕上的像素数据，以便在需要时快速读取并更新图像。GRAM有助于提高OLED显示屏的刷新速度和响应性能。
  * SRAM：即"**S**tatic **R**andom-**A**ccess **M**emory"（**静态随机存取存储器**），是随机存取存储器的一种。
* 解决方法的缺点：
  * 对于SRAM 很小的单片机不友好
  * 每次修改都写入全屏会导致屏幕刷新率降低
