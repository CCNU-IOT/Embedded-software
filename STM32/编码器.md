# 编码器

作者：嵌入式软件:pen:

## 1.编码器简介：

- **编码器**:tanabata_tree:：
  - 将**角位移**和**直线位移**转换成**可传输的电信号**。
    - **码盘**：将**角位移**转换成可传输电信号。
    - **码尺**：将**直线位移**转换成可传输电信号。

<img src="https://nickaljy-pictures.oss-cn-hangzhou.aliyuncs.com/7af40ad162d9f2d3002cde0ba9ec8a136327cc11.jpg" alt="7af40ad162d9f2d3002cde0ba9ec8a136327cc11" style="zoom:33%;" />

- **编码器作用**:facepunch:：
  - 测量物体的**位置**、**角度**、**速度**。

## 2.编码器分类：

#### 2.1 增量编码器：

- **编码原理**:rabbit:：
  - 将**位移(角位移/直线位移)**转换成**计数脉冲**，用**脉冲个数**表示**位移大小**。
- **特点**：
  - **增量式编码器**着重计算**位移**和**速度**。
- **分类**：
  - **增量式磁电编码器**：
    - **增量式磁电编码器是我们研究的重点，后面均以增量式磁电编码器为例**。
    - **霍尔传感器**:dash:：
      - 利用**霍尔效应**
  - **增量式光电编码器**：
    - **增量式光电编码器分辨率更高，同样是我们研究的重点**。

#### 2.2 绝对编码器：

- **编码原理:radio:**：
  - **绝对编码器**的每一个位置有一个确定的**数字编码**，通过**起始/终止位置**的数字编码确定**位置/角度**。
- **特点**：
  - **绝对式编码器**着重计算**位置**和**角度**。
- **分类**：
  - **绝对式磁电编码器**
  - **绝对式光电编码器**

<img src="https://nickaljy-pictures.oss-cn-hangzhou.aliyuncs.com/Gray_code_rotary_encoder_13-track_opened.jpg" alt="Gray_code_rotary_encoder_13-track_opened" style="zoom:33%;" />

## 3.编码器的参数：

#### 3.1 分辨率(PPR)：

- **分辨率**表示编码器测量的**最小距离**。
  - 对于**增量式编码器**来讲，**分辨率**表示**转轴每旋转一圈输出的脉冲个数**，用"**线**"表示:sailboat:。
    - 例如：转轴每旋转一圈，编码器输出**10**个脉冲，那么该编码器的**分辨率**是**10线**。

#### 3.2 精度：

- **精度**表示编码器**输出的信号数据**与**实际值**之间的**误差**，通常用**"角分"**、**"角秒"**表示。

#### 3.3 最大响应频率(PPS)：

- 编码器**每秒**输出的**最大脉冲数**，单位**Hz**。

#### 3.4 最大转速：

- 编码器的机械系统所能承受的**最高转速**。

## 4.增量编码器测速原理：

#### 4.1 电机相关参数：

- 在介绍增量编码器的**测速原理**之前，先理解一下和测速有关的**电机参数**：**减速比**:gear:

  - 实验室目前所用的**直流有刷电机**是**MG513**:camera:：

  - <img src="https://nickaljy-pictures.oss-cn-hangzhou.aliyuncs.com/img_v2_45c66c74-6da9-4951-88a1-a2a15f4fa43g.jpg" alt="img_v2_45c66c74-6da9-4951-88a1-a2a15f4fa43g" style="zoom:50%;" />
  - **直流有刷电机**为了避免电机转轴旋转速度过快，通常会搭配**减速箱**，因此我们要知道电机的**减速比**。
  - <img src="https://nickaljy-pictures.oss-cn-hangzhou.aliyuncs.com/img_v2_e6975351-2fb5-4f06-a14c-0d3b43340ddg.jpg" alt="img_v2_e6975351-2fb5-4f06-a14c-0d3b43340ddg" style="zoom: 67%;" />
    - **1:30减速比**：
      - 电机的**转轴**每旋转一圈，电机的**转子**旋转30圈。

- **注意，编码器的转轴连接到电机的转子上面**。

#### 4.2 编码器相关参数：

- **分辨率**:waning_gibbous_moon:：
  - **霍尔编码器**的**稳定性高**，因此直接**裸露**在电机外侧，不需要外壳保护。
  - <img src="https://nickaljy-pictures.oss-cn-hangzhou.aliyuncs.com/img_v2_f9d4448b-40c9-4942-9dbc-5f93f9b5092g.jpg" alt="img_v2_f9d4448b-40c9-4942-9dbc-5f93f9b5092g" style="zoom:50%;" />
  - 该款电机搭配**13PPR**霍尔编码器。
    - 霍尔编码器每旋转一圈，产生**13个计数脉冲**。
- **供电范围**:expressionless:：
  - 该款电机的霍尔编码器供电范围：**3.3 ~ 5v**

#### 4.3 测速原理：

- 这里以**旋转型增量编码器**(可测量**角位移**)为例，编码器在旋转过程中有**两相**(当然也有三相输出的:volcano:)输出，分别称为**A相**和**B相**，**A相**和**B相**的**计数脉冲**数量相同，但两相输出是**正交输出**(相位相差90°)。
- **测速**：
  - 对**A相/B相**的脉冲进行计数，可以得到$dt$时间内编码器的**脉冲总数**$Sum_{epulse}$
  - 已知编码器**分辨率**：**13PPR**，因此$dt$时间内编码器的**旋转圈数**$Sum_{ecircle} = Sum_{epulse} / 13$
  - 已知电机的**减速比**是**1:30**，因此$dt$时间内电机的**旋转圈数**$Sum_{mcircle} = Sum_{ecircle} / 30$
  - 最终求出**1min**内电机的旋转圈数，即可得到电机的转速**RPM**。
- **测旋转方向**：
  - **我们以计数脉冲的上升沿为参照点**。
  - 由于**A/B两相正交**，因此存在两种情况：
    - **A相上升沿在B相前面**:3rd_place_medal:：
      - 此时编码器**顺时针**旋转，认为电机**正转**。
    - **B相上升沿在A相前面**:2nd_place_medal:：
      - 此时编码器**逆时针**旋转，认为电机**反转**。

<img src="https://nickaljy-pictures.oss-cn-hangzhou.aliyuncs.com/1920px-Quadrature_Diagram.svg.png" alt="1920px-Quadrature_Diagram.svg" style="zoom: 33%;" />

## 5.STM32的编码器驱动代码：



